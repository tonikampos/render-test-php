<div class="habilidades-container">
  <!-- Header -->
  <div class="page-header">
    <h1>
      <mat-icon>category</mat-icon>
      Habilidades Disponibles
    </h1>
    <p class="subtitle">Explora ofertas y demandas de nuestra comunidad</p>
  </div>

  <!-- Filtros -->
  <mat-card class="filters-card">
    <form [formGroup]="filterForm" class="filters-form">
      <!-- Fila 1: Búsqueda principal y Tipo -->
      <div class="filters-row filters-main">
        <!-- Búsqueda -->
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar</mat-label>
          <input matInput formControlName="search" placeholder="Ej: programación, inglés...">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>

        <!-- Tipo -->
        <mat-form-field appearance="outline">
          <mat-label>Tipo</mat-label>
          <mat-select formControlName="tipo">
            <mat-option value="">Todos</mat-option>
            <mat-option value="oferta">Ofertas</mat-option>
            <mat-option value="demanda">Demandas</mat-option>
          </mat-select>
          <mat-icon matPrefix>swap_horiz</mat-icon>
        </mat-form-field>

        <!-- Ordenar -->
        <mat-form-field appearance="outline">
          <mat-label>Ordenar por</mat-label>
          <mat-select formControlName="orden">
            <mat-option *ngFor="let opt of ordenOptions" [value]="opt.value">
              {{ opt.label }}
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>sort</mat-icon>
        </mat-form-field>

        <!-- Botón Filtros Avanzados -->
        <button 
          mat-stroked-button 
          type="button" 
          class="toggle-filters-btn"
          (click)="toggleFilters()">
          <mat-icon>{{ filtersExpanded ? 'expand_less' : 'tune' }}</mat-icon>
          Filtros Avanzados
          <span *ngIf="activeFiltersCount > 0" class="filter-badge">{{ activeFiltersCount }}</span>
        </button>
      </div>

      <!-- Panel Expandible: Filtros Avanzados -->
      <mat-expansion-panel 
        [(expanded)]="filtersExpanded"
        class="filters-expansion">
        <div class="filters-row">
          <!-- Categoría -->
          <mat-form-field appearance="outline">
            <mat-label>Categoría</mat-label>
            <mat-select formControlName="categoria">
              <mat-option value="">Todas</mat-option>
              <mat-option *ngFor="let cat of categorias" [value]="cat.nombre">
                {{ cat.nombre }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>label</mat-icon>
          </mat-form-field>

          <!-- Ubicación -->
          <mat-form-field appearance="outline">
            <mat-label>Ubicación</mat-label>
            <input matInput formControlName="ubicacion" placeholder="Ciudad...">
            <mat-icon matPrefix>location_on</mat-icon>
          </mat-form-field>

          <!-- Duración -->
          <mat-form-field appearance="outline">
            <mat-label>Duración estimada</mat-label>
            <mat-select formControlName="duracion">
              <mat-option value="">Cualquiera</mat-option>
              <mat-option *ngFor="let opt of duracionOptions" [value]="opt.value">
                {{ opt.label }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>schedule</mat-icon>
          </mat-form-field>

          <!-- Modalidad -->
          <mat-form-field appearance="outline">
            <mat-label>Modalidad</mat-label>
            <mat-select formControlName="modalidad">
              <mat-option value="">Cualquiera</mat-option>
              <mat-option *ngFor="let opt of modalidadOptions" [value]="opt.value">
                {{ opt.label }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>language</mat-icon>
          </mat-form-field>
        </div>

        <!-- Botón Limpiar Filtros -->
        <div class="filters-actions">
          <button mat-stroked-button type="button" (click)="clearFilters()" color="warn">
            <mat-icon>clear_all</mat-icon>
            Limpiar todos los filtros
          </button>
        </div>
      </mat-expansion-panel>
    </form>
  </mat-card>

  <!-- Loading Skeleton -->
  <div *ngIf="loading" class="habilidades-grid">
    <app-skeleton-loader 
      *ngFor="let i of [1,2,3,4,5,6,7,8,9,10,11,12]" 
      type="card">
    </app-skeleton-loader>
  </div>

  <!-- Grid de Habilidades -->
  <div *ngIf="!loading && habilidades.length > 0" class="habilidades-grid">
    <mat-card *ngFor="let habilidad of habilidades" class="habilidad-card">
      <!-- Badge Tipo -->
      <div class="tipo-badge" [class.oferta]="habilidad.tipo === 'oferta'" [class.demanda]="habilidad.tipo === 'demanda'">
        <mat-icon>{{ getTipoIcon(habilidad.tipo) }}</mat-icon>
        <span>{{ habilidad.tipo | uppercase }}</span>
      </div>

      <!-- Badge Pausada -->
      <div *ngIf="habilidad.estado === 'pausada'" class="pausada-badge">
        <mat-icon>pause_circle</mat-icon>
        <span>PAUSADA</span>
      </div>

      <mat-card-header>
        <mat-card-title>
          <a [routerLink]="['/habilidades', habilidad.id]">
            {{ habilidad.titulo }}
          </a>
        </mat-card-title>
        <mat-card-subtitle>
          <mat-icon inline="true">label</mat-icon>
          {{ habilidad.categoria }}
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <p class="descripcion">{{ habilidad.descripcion | slice:0:120 }}{{ habilidad.descripcion.length > 120 ? '...' : '' }}</p>
        
        <div class="habilidad-meta">
          <div class="meta-item">
            <mat-icon>person</mat-icon>
            <span>{{ habilidad.usuario_nombre }}</span>
          </div>
          <div class="meta-item">
            <mat-icon>location_on</mat-icon>
            <span>{{ habilidad.usuario_ubicacion }}</span>
          </div>
          <div *ngIf="habilidad.duracion_estimada" class="meta-item">
            <mat-icon>schedule</mat-icon>
            <span>{{ habilidad.duracion_estimada }} min</span>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button [routerLink]="['/habilidades', habilidad.id]" color="primary">
          Ver Detalle
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Sin Resultados -->
  <div *ngIf="!loading && habilidades.length === 0" class="no-results">
    <div class="no-results-icon">
      <mat-icon>search_off</mat-icon>
    </div>
    <h2>No se encontraron habilidades</h2>
    <p>Intenta ajustar los filtros de búsqueda o explora otras categorías</p>
    <div class="no-results-actions">
      <button mat-raised-button color="primary" (click)="clearFilters()">
        <mat-icon>refresh</mat-icon>
        Limpiar Filtros
      </button>
      <button mat-stroked-button routerLink="/habilidades/nueva" *ngIf="authService.isAuthenticated()">
        <mat-icon>add</mat-icon>
        Ofrecer Habilidad
      </button>
    </div>
  </div>

  <!-- Paginación -->
  <mat-paginator
    *ngIf="!loading && totalItems > 0"
    [length]="totalItems"
    [pageSize]="pageSize"
    [pageSizeOptions]="[6, 12, 24, 48]"
    [pageIndex]="currentPage - 1"
    (page)="onPageChange($event)"
    showFirstLastButtons>
  </mat-paginator>
</div>
