<div class="perfil-container">
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Cargando perfil...</p>
  </div>

  <div *ngIf="!loading && usuario; else noUsuario">
    <header class="perfil-header">
      <div class="perfil-info">
        <h1>{{ usuario.nombre_usuario }}</h1>
        <p class="ubicacion">
          <mat-icon>location_on</mat-icon> {{ usuario.ubicacion }}
        </p>
      </div>
      
      <!-- Acciones solo si no es tu propio perfil -->
      <div class="perfil-actions" *ngIf="!isOwnProfile">
        <!-- Botón para usuarios autenticados -->
        <button 
          *ngIf="isLoggedIn"
          mat-raised-button 
          color="primary"
          (click)="iniciarConversacion()"
          [disabled]="sendingMessage">
          <mat-icon>chat</mat-icon>
          <span *ngIf="!sendingMessage">Enviar mensaje</span>
          <span *ngIf="sendingMessage">Enviando...</span>
        </button>

        <!-- Botón para usuarios NO autenticados -->
        <button 
          *ngIf="!isLoggedIn"
          mat-stroked-button 
          color="primary"
          routerLink="/login">
          <mat-icon>login</mat-icon>
          Inicia sesión para contactar
        </button>
      </div>
    </header>

    <section class="perfil-section" *ngIf="usuario.biografia">
      <h2>Sobre mí</h2>
      <p>{{ usuario.biografia }}</p>
    </section>

    <section class="perfil-section">
      <app-valoraciones-list [usuarioNombre]="usuario.nombre_usuario" [valoraciones]="valoraciones"></app-valoraciones-list>
    </section>
  </div>

  <ng-template #noUsuario>
    <div *ngIf="!loading">
      <p>Non se puido atopar o usuario.</p>
    </div>
  </ng-template>
</div>