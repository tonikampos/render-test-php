<div style="padding: 40px; background: white; max-width: 500px; margin: 50px auto; border: 2px solid #3f51b5; border-radius: 8px;">
  <h1 style="color: #3f51b5; text-align: center;">🔐 Restablecer Contraseña</h1>
  
  <!-- Test: Mensaje simple para verificar que el componente carga -->
  <div style="margin: 20px 0; padding: 15px; background: #e3f2fd; border-radius: 4px;">
    <p><strong>DEBUG INFO:</strong></p>
    <p>Token: <code>{{ token || 'NO TOKEN' }}</code></p>
    <p>Error Message: {{ errorMessage || 'None' }}</p>
    <p>Reset Success: {{ resetSuccess }}</p>
  </div>

  <!-- Mensaje de éxito -->
  <div *ngIf="resetSuccess" style="padding: 20px; background: #4caf50; color: white; border-radius: 4px; text-align: center; margin-top: 20px;">
    <h2>✅ ¡Contraseña actualizada!</h2>
    <p>Tu contraseña ha sido restablecida correctamente.</p>
    <p>Redirigiendo al login en 3 segundos...</p>
  </div>

  <!-- Formulario -->
  <form *ngIf="!resetSuccess" [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" style="margin-top: 20px;">
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nueva Contraseña:</label>
      <input 
        type="password" 
        formControlName="newPassword"
        style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px;"
        placeholder="Ingresa tu nueva contraseña">
      
      <div *ngIf="newPassword?.invalid && newPassword?.touched" style="color: red; margin-top: 5px;">
        <small *ngIf="newPassword?.errors?.['required']">La contraseña es requerida</small>
        <small *ngIf="newPassword?.errors?.['passwordStrength']">
          La contraseña debe tener al menos 8 caracteres, letras y números
        </small>
      </div>
    </div>

    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 5px; font-weight: bold;">Confirmar Contraseña:</label>
      <input 
        type="password" 
        formControlName="confirmPassword"
        style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px;"
        placeholder="Confirma tu contraseña">
      
      <div *ngIf="confirmPassword?.invalid && confirmPassword?.touched" style="color: red; margin-top: 5px;">
        <small *ngIf="confirmPassword?.errors?.['required']">Debes confirmar la contraseña</small>
      </div>
      
      <div *ngIf="resetPasswordForm.errors?.['passwordMismatch'] && confirmPassword?.touched" style="color: red; margin-top: 5px;">
        <small>Las contraseñas no coinciden</small>
      </div>
    </div>

    <!-- Password Requirements -->
    <div *ngIf="newPassword?.value" style="margin: 15px 0; padding: 10px; background: #f5f5f5; border-radius: 4px;">
      <p style="margin: 0 0 8px 0; font-weight: bold;">Requisitos de la contraseña:</p>
      <div style="display: flex; align-items: center; margin: 4px 0;">
        <span [style.color]="hasMinLength() ? 'green' : 'red'">
          {{ hasMinLength() ? '✓' : '✗' }}
        </span>
        <span style="margin-left: 8px;">Mínimo 8 caracteres</span>
      </div>
      <div style="display: flex; align-items: center; margin: 4px 0;">
        <span [style.color]="hasLetters() ? 'green' : 'red'">
          {{ hasLetters() ? '✓' : '✗' }}
        </span>
        <span style="margin-left: 8px;">Contiene letras</span>
      </div>
      <div style="display: flex; align-items: center; margin: 4px 0;">
        <span [style.color]="hasNumbers() ? 'green' : 'red'">
          {{ hasNumbers() ? '✓' : '✗' }}
        </span>
        <span style="margin-left: 8px;">Contiene números</span>
      </div>
    </div>

    <div *ngIf="errorMessage && !resetSuccess" style="padding: 10px; background: #ffebee; color: #c62828; border-radius: 4px; margin: 15px 0;">
      <strong>⚠️ Error:</strong> {{ errorMessage }}
    </div>

    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button 
        type="submit" 
        [disabled]="loading || resetPasswordForm.invalid"
        style="flex: 1; padding: 12px; background: #3f51b5; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;"
        [style.opacity]="loading || resetPasswordForm.invalid ? '0.5' : '1'">
        {{ loading ? '⌛ Actualizando...' : '🔒 Restablecer Contraseña' }}
      </button>
      
      <a 
        routerLink="/login" 
        style="flex: 1; padding: 12px; background: #f5f5f5; color: #333; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; text-decoration: none; text-align: center; display: block;">
        Cancelar
      </a>
    </div>

    <div style="margin-top: 20px; padding: 10px; background: #fff3cd; border-radius: 4px; font-size: 14px;">
      <strong>🔒 Nota de seguridad:</strong> Por tu seguridad, el enlace de recuperación expira en 1 hora y solo puede usarse una vez.
    </div>
  </form>
</div>
